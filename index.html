<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒç‰©èªå¥³åƒ•å’–å•¡å»³ï¼šç”œèœœåˆæˆè¡“</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fff7ed; /* orange-50 / Creamy Milk Tea color */
            color: #431407; /* amber-950 / Dark Coffee */
        }

        /* Custom Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        .animate-bounce-in {
            animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }

        @keyframes coinJump {
            0%, 100% { transform: translateY(0) scale(1); color: #f59e0b; }
            50% { transform: translateY(-5px) scale(1.2); color: #fbbf24; }
        }
        .animate-coin-jump {
            animation: coinJump 0.3s ease-in-out;
        }
        
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Custom Scrollbar for inventory */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #fff7ed; 
        }
        ::-webkit-scrollbar-thumb {
            background: #fed7aa; 
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #fdba74; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- Icons Components ---
        const IconBase = ({ size = 24, className = "", children }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Sparkles = (props) => (
            <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></IconBase>
        );
        const FlaskConical = (props) => (
            <IconBase {...props}><path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2"/><path d="M8.5 2h7"/><path d="M7 16h10"/></IconBase>
        );
        const ShoppingBag = (props) => (
            <IconBase {...props}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></IconBase>
        );
        const Coins = (props) => (
            <IconBase {...props}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7 .71-2.82 2.82"/></IconBase>
        );
        const Trash2 = (props) => (
            <IconBase {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>
        );
        const Zap = (props) => (
            <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>
        );
        const Crown = (props) => (
            <IconBase {...props}><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></IconBase>
        );
        const Heart = (props) => (
            <IconBase {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></IconBase>
        );
        const Gift = (props) => (
            <IconBase {...props}><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></IconBase>
        );
        const Ticket = (props) => (
            <IconBase {...props}><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/></IconBase>
        );
        const X = (props) => (
            <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>
        );
        const ThumbsUp = (props) => (
            <IconBase {...props}><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></IconBase>
        );
        const BookOpen = (props) => (
            <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></IconBase>
        );
        const Handshake = (props) => (
            <IconBase {...props}><path d="m11 11 1.35-1.35a5.025 5.025 0 0 1 2.275-.85 2.5 2.5 0 0 1 2.975 1.6 5.379 5.379 0 0 1-.875 4.3l-5.7 5.7L6 15l5-5Z"/><path d="M18 4a2.5 2.5 0 0 0-4.084 1.258"/><path d="M22 6a2.5 2.5 0 0 0-3.326-1.077"/><path d="M2 12h2"/><path d="M4 12v-2a2 2 0 0 1 2-2h2.004"/></IconBase>
        );
        const ChevronDown = (props) => (
            <IconBase {...props}><path d="m6 9 6 6 6-6"/></IconBase>
        );
        const ChevronUp = (props) => (
            <IconBase {...props}><path d="m18 15-6-6-6 6"/></IconBase>
        );


        // --- é…ç½®èˆ‡è³‡æ–™ ---
        // èª¿æ•´æ©Ÿç‡: UR 2%, SSR 5%
        // å‰©é¤˜: 1 - 0.02 - 0.05 = 0.93. 
        // SR: 0.13, R: 0.30, N: 0.50 (ç¸½å’Œ 1.0)
        const TIERS = {
          UR: { label: 'UR', name: 'å‚³èªªãƒ»å¥‡è¹Ÿé‚‚é€…', color: 'text-rose-600', bg: 'bg-rose-100', border: 'border-rose-400', probability: 0.02, icon: 'ğŸ‘‘' },
          SSR: { label: 'SSR', name: 'ç’€ç’¨ãƒ»é–ƒè€€èª“è¨€', color: 'text-amber-600', bg: 'bg-amber-100', border: 'border-amber-400', probability: 0.05, icon: 'âœ¨' },
          SR: { label: 'SR', name: 'ç”œèœœãƒ»å¿ƒå‹•é­”æ³•', color: 'text-purple-600', bg: 'bg-purple-100', border: 'border-purple-300', probability: 0.13, icon: 'ğŸ’–' },
          R: { label: 'R', name: 'æº«é¦¨ãƒ»æ—¥å¸¸ç‰©èª', color: 'text-blue-600', bg: 'bg-blue-100', border: 'border-blue-300', probability: 0.30, icon: 'ğŸ€' },
          N: { label: 'N', name: 'å¹¸é‹ãƒ»å¾®å°ç¥ç¦', color: 'text-stone-500', bg: 'bg-stone-50', border: 'border-stone-300', probability: 0.50, icon: 'â˜•' },
        };

        const ITEMS_DATA = {
          UR: [
            "å°ˆå±¬ 10min è¦–è¨Šé€šè©±", 
            "æŒ‡å®šå¥³åƒ•æ‰‹å¯«ä¿¡", 
            "ä¸€æ—¥å»šæˆ¿å°ç²¾éˆé«”é©—", 
            "ç•¶æ—¥å‡ºå‹¤å…¨å¥³åƒ•æ‰‹æ©Ÿå¤§åˆç…§å…©å¼µ", 
            "è·Ÿå¥³åƒ•ä¸€èµ·æ‹é™æ™‚å‹•æ…‹ä¸€å‰‡", 
            "è·Ÿå¥³åƒ•ä¸€èµ·åœ¨åº—å…§å”±æ­Œ(ä¸€é¦–)",
            "å¥³åƒ•ç‚ºä½ åšå°ˆå±¬ä¾¿ç•¶/ä¸»é¤",
            "æŒ‡å®šå¥³åƒ•ä¸€èµ·æ‰“éŠæˆ²(ç”±å¥³åƒ•æ±ºå®šéŠæˆ²)",
            "å°ˆå±¬èµ·åºŠé¬§é˜éŒ„éŸ³(å®¢è£½åŒ–)",
            "å¿ƒç‰©èªå…¨å“¡ç”Ÿæ—¥å¿«æ¨‚æ­Œå½±ç‰‡",
            "å¥³åƒ•è¦ªæ‰‹è¨­è¨ˆçš„ä¼¼é¡ç¹ªTæ¤",
            "èˆ‡å¥³åƒ•çš„æ¨¡æ“¬ç´„æœƒ10min(åº—å…§ç”¨é¤)",
            "ä»»é¸å¥³åƒ•ç§å¯†èªéŸ³æª”ï¼šç¡å‰æ‚„æ‚„è©±",
            "å¥³åƒ•å…¨å“¡å”‡å°ç°½åæ¿",
            "30ç§’æ‰‹æ©Ÿæ‹åˆ°é£½",
            "å¥³åƒ•è¦ªæ‰‹è£½ä½œçš„ç”œé»(ä¸€äººä»½)",
            "æŒ‡å®šå¥³åƒ•æ‹æ”1åˆ†é˜å½±ç‰‡",
            "æŒ‡å®šå¥³åƒ•ç•«åˆ°æ»¿å‡ºä¾†è¶…ç²¾ç·»ç°½ç¹ª",
            "é€²åº—å°ˆå±¬ç‰¹åˆ¥æ‹›å‘¼èª",
            "å¿ƒç‰©èªåˆ¶æœé«”é©—ä¹™æ¬¡"
          ],
          SSR: [
            "å¿ƒç‰©èª5æœˆä»½æ´»å‹•æŒ‡å®šæ¬Šä¸€æ¬¡",
            "ä»»é¸å¥³åƒ•å¯Œå£«æ‹ç«‹å¾—ä¹™å¼µ(ç¾å ´æ‹)", 
            "15ç§’å®¢è£½åŒ–å½±ç‰‡åˆ¸", 
            "æˆå“¡çš„éš¨èº«å°ç‰© (è¤‡è£½å“)",
            "æŒ‡å®šå¥³åƒ•ç°½ç¹ªæ¿(å°)", 
            "å…¨å“¡å¥³åƒ•æ›è»¸(å°)",
            "ä»Šæ—¥åº—å…§æ’­æ”¾æ­Œå–®æ±ºå®šæ¬Š", 
            "æŒ‡å®šå¥³åƒ•ç™¼æ–‡(å¥³åƒ•æ—¥è¨˜)åœ¨å¿ƒç‰©èªè‡‰æ›¸", 
            "æ‹ç«‹å¾—å…Œæ›åˆ¸äº”å¼µ",
            "æŒ‡å®šæˆå“¡çš„ç§ç‰©",
            "å¥³åƒ•é›¨æœå¯«çœŸé›†(å…¨å“¡)",
            "å¥³åƒ•åˆ¶æœå¯«çœŸé›†(éš¨æ©Ÿæˆå“¡)",
            "é¸æ“‡ä¸€ä½å¥³åƒ•åä½ æ—é‚Š30ç§’äº’å‹•",
            "å¥³åƒ•è¦ªè‡ªç‚ºä½ ç•«ä¼¼é¡ç¹ª(å«ä¸Šè‰²)",
            "æŒ‡å®šå¥³åƒ•æ‹ç«‹å¾—ç›¸å†Šä¸€æœ¬"
          ],
          SR: [
            "ç—›æ‰“æ³¡èŠ™å·",
            "æŒ‡å®šå¥³åƒ•æ‰‹ç¹ªæ’²å…‹ç‰Œæ‹ç«‹å¾—ä¹™å¼µ",
            "ç°½æ‹å…Œæ›åˆ¸(æŒ‡å®šå¥³åƒ•)", 
            "æ‰‹æ©Ÿæ‹åˆ¸ (æŒ‡å®šå¥³åƒ•)", 
            "çµå¸³é‡åˆ°éŠæˆ²é—œå¡ç›´æ¥éé—œåˆ¸", 
            "æŒ‡å®šå¥³åƒ•ç‰¹è£½æ‰‹æ©Ÿæ¡Œå¸ƒ ",
            "éš¨æ©Ÿç²¾ç·»æ‹ (Random Deco Cheki)", 
            "æ´»å‹•æ—¥é ç´„å„ªå…ˆåˆ¸", 
            "éå¾€å¥³åƒ•å¾½ç« ç›²æŠ½2æŠ½",
            "é›™äººå¥³åƒ•åˆç…§åˆ¸ (æ‰‹æ©Ÿæ‹)",
            "ç°¡æ˜“ç°½ç¹ªæ³³è£æ‹(éš¨æ©Ÿå¥³åƒ•)",
            "ä¸‰äººå¥³åƒ•åˆç…§æ‹ç«‹å¾—(å·²æ‹å¥½,éš¨æ©Ÿ)",
            "æŒ‡å®šå§¿å‹¢æ‹ç«‹å¾—(æ‘¸é ­)",
            "æŒ‡å®šå§¿å‹¢æ‹ç«‹å¾—(æ„›å¿ƒ)",
            "å¥³åƒ•çš„é­”æ³•å’’èªå½±ç‰‡",
            "èˆ‡å¥³åƒ•æ¯”è…•åŠ›æŒ‘æˆ°",
            "æ·±æƒ…å°è¦–æŒ‘æˆ°(10ç§’)",
            "æ‹ç«‹å¾—èƒŒé¢æ’°å¯«å…Œæ›åˆ¸",
            "ç•¶æ—¥çµå¸³é‡‘é¡å¤šé€2é»",
            "å„ç¨®è€³é£¾é€ å‹ç°¡æ˜“ç°½æ‹(è²“è€³/å…”è€³ç­‰)",
            "æè‡‰é °æ‹ç«‹å¾—",
            "æ‰‹èƒŒå»(éš”ç©º)æ‹ç«‹å¾—",
            "å¥³åƒ•ç”Ÿæ°£ç½µäººèªéŸ³(çå‹µ?)",
            "å¥³åƒ•ä¾†åº—æ‹›å‘¼å½±ç‰‡(å…¨å“¡)",
            "è´ˆé€ä¸€ä»½é¬†é¤…(ä»»é¸å£å‘³)",
            "å¥³åƒ•æ¨¡ä»¿ç§€(15ç§’)",
            "è´ˆé€ä¸€ä»½çƒ¤å¸ƒè•¾",
            "æŒ‡å®šæˆå“¡çš„ææ€ªè‡ªæ‹",
            "è´ˆé€ä¸€æ¯ç´…èŒ¶",
            "è´ˆé€ä¸€ä»½é­”æ³•å¥—é¤(å«æ‹ç«‹å¾—)"
          ],
          R: [
            "éš¨æ©Ÿå¥³åƒ•ç™½æ‹ (ç„¡ç°½å)", "å¥³åƒ•ç™½æ‹  (æŒ‡å®šæˆå“¡)", "ç°½ç¹ªåˆ¸ (ç‰©å“)", "å¿ƒç‰©èªé»æ•¸x1",
            "éš¨æ©Ÿç”Ÿå¯«çœŸä¹™å¼µ", "å¿ƒç‰©èªäº¤æ›æ—¥è¨˜ä¸€æœ¬", "å¥³åƒ•æ¡æ‰‹åˆ¸ (3ç§’)", 
            "å¤¢å¤¢ é¡è—ä¸‰ç¨®(ä¸å¯æ”å½±)", "å¤¢å¤¢ çš„æ¿€å‹µèªéŸ³15ç§’", "å¤¢å¤¢ çš„å¯æ„›å››é€£æ‹æ‰‹æ©Ÿç…§",
            "Aki å¹«ä½ ç¶é›™é¦¬å°¾(50ç§’äº¤æµ)", "Aki çš„æ»‘é›ªè¬›å ‚(5åˆ†é˜)", "Aki çš„å‚²å¬ŒèªéŸ³",
            "è•¾å¨œå¸¶ä½ å–œæ­¡ç†Šè²“(2åˆ†é˜ç†Šè²“æ¨å»£)", "è•¾å¨œ çš„é«®å‹æ•™å­¸(1åˆ†é˜)", "è•¾å¨œç”¨éçš„poscaæ‹ç­†",
            "å°è‘µ æ¨è–¦ä½ åƒç”œé»(50ç§’äº¤æµ)", "å°è‘µ çš„ç‰¹è£½è‡ªæ‹å°å¡", "å°è‘µ çš„å°ç†Šè²“æ’ç•«",
            "å¾‹ ä¸€èµ·è·³èˆ(20ç§’)", "å¾‹ çš„æ‰‹ç¹ªå‰ä¼Šå¡å“‡æ’åœ–", "å¾‹ çš„æ‡‰æ´æ‰‡",
            "ç¶¾ç¾½ çš„åˆä»£åˆ¶æœç²¾ç·»æ‹ç«‹å¾—", "ç¶¾ç¾½ çš„æ¨è–¦æ›¸å–®(äº¤æµ2åˆ†é˜)", "ç¶¾ç¾½ çš„é¦™æ°´è©¦ç´™",
            "è‰åŠ  çš„ç²¾ç·»ç°½ç¹ªç§æœæ‹ç«‹å¾—", "è‰åŠ  çš„éš¨æ©Ÿç§ç‰©", "è‰åŠ  çš„å§“åè²¼ç´™æ•´å¼µ",
            "å°é¹¿ çš„30ç§’äººç‰©é€Ÿå¯«", "å°é¹¿ çš„ç´™è† å¸¶æ”¶è—(ç§ç‰©)", "å°é¹¿ è¿ªå£«å°¼æ‰‹æ©Ÿç…§ä¹™å¼µ",
            "è·Ÿåƒä»£ä¸€èµ·æ–½ç‹—ç‹—é­”æ³• ", "åƒä»£ çš„äº¤æ›æ—¥è¨˜å›è¦†è³‡æ ¼", "åƒä»£ çš„æ´»å‹•æœæ›¸ç±¤ä¹™å¼µ(å…±10æ¬¾éš¨æ©Ÿ)",
            "åƒéŸ³ çœ‹è‘—ä½ ç”œèœœå¾®ç¬‘5ç§’", "åƒéŸ³ æ¸…å”±å–œæ­¡çš„æ­Œ20ç§’", "åƒéŸ³çš„è¿½æ˜Ÿæ—¥è¨˜(æ‰‹æ©Ÿæ‹ä¹™å¼µ)",
            "ç‰§ çš„è¿½æ˜Ÿæ‰‹æ©Ÿæ‹ä¹™å¼µ", "è·Ÿç‰§ä¸€èµ·æ‹5ç§’çŸ­å½±ç‰‡", "è·Ÿç‰§æŒ‘æˆ°èª°å…ˆç¬‘(è´äº†å¯å¾—æ‰‹æ©Ÿæ‹ä¹™å¼µ)",
            "è·ŸSAYUKIä¸€èµ·çœ‹åˆ€ä¹Ÿå½±ç‰‡5åˆ†é˜", "å’²é›ª çš„ç‰¹è£½é›»ç¹ª", "è·Ÿå’²é›ªä¸€èµ·è·³å¥åº·æ“1åˆ†é˜ ",
            "è·Ÿå°å¤©ä¸€èµ·åé€£æ‰‹æ©Ÿæ‹", "å°å¤© çš„è¿½æ˜Ÿæ‰‹æ©Ÿæ‹", "å°å¤© çš„éŸ“åœ‹å¶åƒè¬›å ‚(5åˆ†é˜)",
            "å°¼å…‹ çš„æ·±æƒ…æ³¨è¦–(5ç§’)", "å°¼å…‹ çš„COSPLAYç²¾ç·»ç°½æ‹", "å°¼å…‹ çš„BLè¬›å ‚(5åˆ†é˜)",
            "éš¨æ©Ÿæˆå“¡æ¯å¢Š", "å¿ƒç‰©èªLogoå¾½ç« ", "æˆå“¡Qç‰ˆé‘°åŒ™åœˆ(éš¨æ©Ÿ)",
            "é€æ˜è³‡æ–™å¤¾", "è¿·ä½ æµ·å ±", "ç´™è† å¸¶(Logoæ¬¾)"
          ],
          N: [
            "ä¸€ç•ªè³ä¸€æ—¥ä¸Šé™é–‹æ”¾è‡³8æŠ½å·",
            "çœ¼ç¥é—œæ„›åˆ¸(5ç§’)", 
            "éš¨æ©Ÿå¥³åƒ•è¡¨æƒ…åŒ…è²¼ç´™(A é¬¥é›çœ¼)", 
            "éš¨æ©Ÿå¥³åƒ•è¡¨æƒ…åŒ…è²¼ç´™(B çœ¨çœ¼)",   
            "éš¨æ©Ÿå¥³åƒ•è¡¨æƒ…åŒ…è²¼ç´™(C ç«Šç¬‘)",   
            "éš¨æ©Ÿå¥³åƒ•è¡¨æƒ…åŒ…è²¼ç´™(D æ€’æ€’è‡‰)", 
            "éš¨æ©Ÿå¥³åƒ•è¡¨æƒ…åŒ…è²¼ç´™(E æ²’ç€æµ·ç‰¹æ®Šé€ å‹)", 
            "é¢ç´™ä¸€åŒ… (å°æœ‰å¿ƒç‰©èªLogo)", 
            "å°é¢ä¸»äººå°ä½ ç¨±è®šä¸‰å¥", 
            "å»šæˆ¿å°ç²¾éˆå¾®ç¬‘ä¸€ç§’",
            "é£²æ–™å¤š10cc",
            "ç©ºæ°£æ“ŠæŒåˆ¸",
            "ç©ºæ°£æ¡æ‰‹åˆ¸",
            "éš±å½¢çš„ç°½å(ç©ºæ°£)",
            "å¿ƒç‰©èªå…¬ç´„å°å¡",
            "å¤¢å¤¢çš„ç²¾ç¥å–Šè©±å¡ç‰‡",
            "ä»Šæ—¥å‡ºå‹¤å¥³åƒ•åˆç…§(é™æ´»å‹•æ—¥)",
            "è¬è¬æƒ é¡§ç³–æœ",
            "çµå¸³å¯æŒ‡å®šå¥³åƒ•"
          ]
        };

        // --- å·¥å…·å‡½æ•¸ ---
        const getRandomItem = (tier) => {
          const list = ITEMS_DATA[tier];
          return list[Math.floor(Math.random() * list.length)];
        };

        const determineTier = () => {
          const rand = Math.random();
          let cumulative = 0;
          if (rand < (cumulative += TIERS.UR.probability)) return 'UR';
          if (rand < (cumulative += TIERS.SSR.probability)) return 'SSR';
          if (rand < (cumulative += TIERS.SR.probability)) return 'SR';
          if (rand < (cumulative += TIERS.R.probability)) return 'R';
          return 'N';
        };

        const getTierOrder = (tier) => {
          const order = ['UR', 'SSR', 'SR', 'R', 'N'];
          return order.indexOf(tier);
        };

        const getNextTier = (tier) => {
          const order = ['N', 'R', 'SR', 'SSR', 'UR'];
          const idx = order.indexOf(tier);
          return idx < order.length - 1 ? order[idx + 1] : null;
        };

        // --- çŒœæ‹³çµ„ä»¶ ---
        const RockPaperScissorsModal = ({ onClose, onWin, onLoseAction }) => {
          const [gameState, setGameState] = useState('choice'); // choice, result
          const [userChoice, setUserChoice] = useState(null);
          const [cpuChoice, setCpuChoice] = useState(null);
          const [result, setResult] = useState(null); // win, lose, draw

          const choices = [
            { id: 'rock', icon: 'âœŠ', label: 'çŸ³é ­' },
            { id: 'paper', icon: 'ğŸ–ï¸', label: 'å¸ƒ' },
            { id: 'scissors', icon: 'âœŒï¸', label: 'å‰ªåˆ€' }
          ];

          const handleChoice = (choiceId) => {
            const cpu = choices[Math.floor(Math.random() * choices.length)];
            setUserChoice(choices.find(c => c.id === choiceId));
            setCpuChoice(cpu);
            
            let res = 'draw';
            if (choiceId === cpu.id) {
              res = 'draw';
            } else if (
              (choiceId === 'rock' && cpu.id === 'scissors') ||
              (choiceId === 'paper' && cpu.id === 'rock') ||
              (choiceId === 'scissors' && cpu.id === 'paper')
            ) {
              res = 'win';
            } else {
              res = 'lose';
            }
            
            setResult(res);
            setGameState('result');

            if (res === 'win') {
              setTimeout(() => {
                onWin();
              }, 1200); 
            }
          };

          const handleReset = () => {
            setGameState('choice');
            setUserChoice(null);
            setCpuChoice(null);
            setResult(null);
          };

          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
              <div className="bg-[#fff7ed] rounded-3xl p-6 w-full max-w-sm shadow-2xl border-4 border-[#fca5a5] animate-bounce-in text-[#431407]">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-xl font-black text-rose-500">ğŸ“ æ²’éŒ¢äº†å—ï¼Ÿä¾†çŒœæ‹³ï¼</h3>
                  <button onClick={onClose} className="text-stone-400 hover:text-stone-600"><X size={24}/></button>
                </div>

                {gameState === 'choice' && (
                  <div className="text-center py-4">
                    <p className="mb-6 font-bold text-stone-600">è´äº†é€ <span className="text-amber-500 text-xl">3000</span> å¹£ï¼</p>
                    <div className="flex justify-center gap-4">
                      {choices.map(c => (
                        <button 
                          key={c.id}
                          onClick={() => handleChoice(c.id)}
                          className="w-20 h-20 rounded-2xl bg-white border-2 border-rose-200 hover:bg-rose-50 hover:scale-110 transition-all text-4xl flex items-center justify-center shadow-sm"
                        >
                          {c.icon}
                        </button>
                      ))}
                    </div>
                  </div>
                )}

                {gameState === 'result' && (
                  <div className="text-center py-4">
                     <div className="flex justify-center items-center gap-8 text-5xl mb-6">
                        <div className="animate-bounce-small">
                          <div className="text-xs font-bold text-stone-400 mb-2">ä½ </div>
                          {userChoice.icon}
                        </div>
                        <div className="text-2xl font-black text-stone-300">VS</div>
                        <div className="animate-bounce-small" style={{ animationDelay: '0.1s' }}>
                           <div className="text-xs font-bold text-stone-400 mb-2">å¿ƒç‰©èª</div>
                           {cpuChoice.icon}
                        </div>
                     </div>

                     {result === 'draw' && (
                       <div>
                         <p className="text-lg font-bold text-stone-500 mb-4">å¹³æ‰‹ï¼å†ä¾†ä¸€æ¬¡ï¼</p>
                         <button onClick={handleReset} className="px-6 py-2 bg-stone-200 rounded-full font-bold text-stone-600">é‡ä¾†</button>
                       </div>
                     )}

                     {result === 'win' && (
                       <div>
                         <p className="text-2xl font-black text-amber-500 mb-2">ä½ è´äº†ï¼ğŸ‰</p>
                         <p className="text-sm text-stone-400">æ­£åœ¨ç™¼é€çå‹µ...</p>
                       </div>
                     )}

                     {result === 'lose' && (
                       <div className="animate-fade-in">
                         <p className="text-lg font-bold text-stone-400 mb-4">å—šå—šè¼¸äº†...</p>
                         <button 
                           onClick={onLoseAction}
                           className="w-full bg-gradient-to-r from-rose-400 to-rose-500 text-white font-bold p-4 rounded-xl shadow-lg hover:shadow-rose-200 hover:scale-[1.02] transition-all flex items-center justify-center gap-2 text-sm"
                         >
                           <Handshake size={18} />
                           æˆ‘æœƒéµå®ˆå¿ƒç‰©èªå…¬ç´„
                         </button>
                         <p className="text-[10px] text-stone-400 mt-2">(é»æ“Šç²å¾— 1000 å¹£)</p>
                       </div>
                     )}
                  </div>
                )}
              </div>
            </div>
          );
        };

        // --- ä¸»æ‡‰ç”¨çµ„ä»¶ ---
        const App = () => {
          const [coins, setCoins] = useState(1000); 
          const [inventory, setInventory] = useState([]);
          const [selectedIds, setSelectedIds] = useState([]);
          const [activeTab, setActiveTab] = useState('gacha'); 
          const [lastDraw, setLastDraw] = useState(null);
          const [alchemyResult, setAlchemyResult] = useState(null);
          const [inventoryView, setInventoryView] = useState('owned'); 
          const [expandedTiers, setExpandedTiers] = useState({ UR: true, SSR: true, SR: true, R: true, N: true });
          
          const [showRPS, setShowRPS] = useState(false);
          const [coinAnimating, setCoinAnimating] = useState(false);
          
          // ä¿åº•èˆ‡ç´¯è¨ˆæŠ½æ•¸ State
          const [pityCounter, setPityCounter] = useState(0); 
          const [totalDraws, setTotalDraws] = useState(0); 

          const TIER_ORDER = ['UR', 'SSR', 'SR', 'R', 'N'];

          // è§¸ç™¼é‡‘å¹£å‹•ç•«
          const triggerCoinAnim = () => {
             setCoinAnimating(true);
             setTimeout(() => setCoinAnimating(false), 300);
          };

          const toggleTier = (tier) => {
            setExpandedTiers(prev => ({ ...prev, [tier]: !prev[tier] }));
          };

          const handleDraw = (amount = 1) => {
            const cost = amount * 100;
            
            if (coins < cost) {
              setShowRPS(true);
              return;
            }

            const newItems = [];
            let currentPity = pityCounter;

            for (let i = 0; i < amount; i++) {
              let tier;
              
              // ä¿åº•æ©Ÿåˆ¶: æ¯ 100 æŠ½ä¿åº• UR (å³ currentPity 0~98 ç‚ºæ™®é€š, 99 ç‚ºä¿åº•)
              if (currentPity >= 99) { 
                 tier = 'UR';
                 currentPity = 0;
              } else {
                 tier = determineTier();
                 if (tier === 'UR') {
                    currentPity = 0; // æŠ½åˆ° UR é‡ç½®ä¿åº•
                 } else {
                    currentPity++;
                 }
              }

              const itemName = getRandomItem(tier);
              newItems.push({
                id: Date.now() + i + Math.random(),
                tier,
                name: itemName,
                isNew: true
              });
            }

            setCoins(prev => prev - cost);
            setInventory(prev => [...newItems, ...prev]);
            setLastDraw(newItems);
            setAlchemyResult(null);
            setPityCounter(currentPity);
            setTotalDraws(prev => prev + amount);
          };

          const handleRPSWin = () => {
            setCoins(prev => prev + 3000); 
            triggerCoinAnim();
            setShowRPS(false);
            // alert removed as requested
          };

          const handleRPSLoseAction = () => {
            setCoins(prev => prev + 1000); 
            triggerCoinAnim();
            setShowRPS(false);
            // alert removed as requested
          };

          // åˆæˆè¡“é‚è¼¯ï¼šéœ€è¦ 4 å€‹ç‰©å“
          const handleTransmute = () => {
            if (selectedIds.length !== 4) return;

            const item1 = inventory.find(i => i.id === selectedIds[0]);

            if (!item1) {
              alert("åˆæˆå¤±æ•—ï¼šç‰©å“éŒ¯èª¤");
              return;
            }

            setInventory(prev => prev.filter(i => !selectedIds.includes(i.id)));
            setSelectedIds([]);

            const currentTier = item1.tier;
            // æˆåŠŸæ©Ÿç‡ > 0.33 (67% æˆåŠŸ)
            const isSuccess = Math.random() > 0.33;
            
            let resultItem;
            let resultStatus;

            if (isSuccess) {
               // æˆåŠŸ -> SR
               const tier = 'SR';
               const itemName = getRandomItem(tier);
               resultItem = { id: Date.now(), tier, name: itemName, isNew: true };
               resultStatus = 'success';
            } else {
               // å¤±æ•— -> R æˆ– N
               const failTier = Math.random() > 0.5 ? 'R' : 'N';
               const itemName = getRandomItem(failTier);
               resultItem = { id: Date.now(), tier: failTier, name: itemName, isNew: true };
               resultStatus = 'fail';
            }

            setInventory(prev => [resultItem, ...prev]);
            setAlchemyResult({ status: resultStatus, item: resultItem, fromTier: currentTier });
          };

          const toggleSelection = (id) => {
            if (activeTab !== 'alchemy') return;

            const item = inventory.find(i => i.id === id);
            if (!item) return;

            if (item.tier === 'UR') {
              alert("å‚³èªªç´šå¹»æƒ³éæ–¼å¼·å¤§ï¼Œç„¡æ³•æ”¾å…¥åˆæˆå°ï¼");
              return;
            }

            if (selectedIds.includes(id)) {
              setSelectedIds(prev => prev.filter(sid => sid !== id));
            } else {
              if (selectedIds.length > 0) {
                const firstItem = inventory.find(i => i.id === selectedIds[0]);
                if (firstItem && firstItem.tier !== item.tier) {
                  alert("åˆæˆè¡“å¿…é ˆä½¿ç”¨åŒéšç´šç‰©å“ï¼");
                  return;
                }
              }

              if (selectedIds.length >= 4) {
                setSelectedIds(prev => [...prev.slice(1), id]);
              } else {
                setSelectedIds(prev => [...prev, id]);
              }
            }
          };

          const sortedInventory = useMemo(() => {
            return [...inventory].sort((a, b) => {
                const tierDiff = getTierOrder(a.tier) - getTierOrder(b.tier);
                if (tierDiff !== 0) return tierDiff;
                return a.name.localeCompare(b.name);
            });
          }, [inventory]);

          const ItemCard = ({ item, isSelected, onClick, count = 0, isCollectionMode = false, isOwned = true }) => {
            const style = TIERS[item.tier];
            
            if (isCollectionMode && !isOwned) {
              return (
                <div className="relative p-3 rounded-2xl border-2 border-stone-200 bg-stone-100 opacity-60 grayscale cursor-not-allowed h-full flex flex-col justify-between">
                   <div className="flex justify-between items-start mb-2">
                    <span className="font-bold text-[10px] px-2 py-0.5 rounded-full bg-stone-300 text-stone-500 border border-stone-300 flex items-center gap-1">
                      {style.icon} {style.label}
                    </span>
                  </div>
                  <div className="text-sm font-bold leading-tight flex items-center text-stone-400 flex-grow">
                    {item.name}
                  </div>
                  <div className="mt-2 flex items-center justify-center pointer-events-none">
                     <div className="bg-stone-300/20 px-2 py-1 rounded text-[10px] font-bold text-stone-500">æœªè§£é–</div>
                  </div>
                </div>
              );
            }

            return (
              <div 
                onClick={() => onClick && onClick(item.id)}
                className={`
                  relative p-3 rounded-2xl border-2 cursor-pointer transition-all duration-200 shadow-sm h-full flex flex-col justify-between
                  bg-white ${style.border} 
                  ${isSelected ? 'ring-4 ring-rose-200 scale-105 z-10 shadow-lg' : 'hover:scale-102 hover:shadow-md'}
                `}
              >
                <div className="flex justify-between items-start mb-2">
                  <span className={`font-bold text-[10px] px-2 py-0.5 rounded-full bg-white/80 backdrop-blur-sm border ${style.border} ${style.color} shadow-sm flex items-center gap-1`}>
                    {style.icon} {style.label}
                  </span>
                  {item.tier === 'UR' && <Crown size={16} className="text-rose-500 animate-pulse" />}
                  {item.tier === 'N' && (item.name === 'æœ¨è“æ¸£ (å®‰æ…°ç)' || item.name.includes('æ¸£')) && <Trash2 size={16} className="text-stone-400" />}
                </div>
                <div className={`text-sm font-bold leading-tight flex items-center ${item.tier === 'N' ? 'text-stone-500' : 'text-stone-700'} flex-grow`}>
                  {item.name}
                </div>
                {isSelected && (
                   <div className="absolute inset-0 bg-rose-500/10 flex items-center justify-center rounded-2xl backdrop-blur-[1px]">
                     <div className="bg-white text-rose-500 p-2 rounded-full shadow-lg animate-bounce">
                       <Heart size={20} fill="currentColor" />
                     </div>
                   </div>
                )}
                
                {isCollectionMode && count > 0 && (
                  <div className="absolute -top-2 -right-2 bg-gradient-to-r from-rose-400 to-rose-500 text-white text-xs font-black px-2 py-0.5 rounded-full shadow-md border-2 border-white transform scale-100 animate-bounce-small">
                    x{count}
                  </div>
                )}
              </div>
            );
          };

          return (
            <div className="min-h-screen font-sans selection:bg-rose-200 selection:text-rose-900 pb-24 text-[#431407]">
              
              {showRPS && (
                <RockPaperScissorsModal 
                  onClose={() => setShowRPS(false)} 
                  onWin={handleRPSWin}
                  onLoseAction={handleRPSLoseAction}
                />
              )}

              <div className="fixed inset-0 pointer-events-none opacity-5" 
                   style={{ backgroundImage: 'radial-gradient(circle, #fca5a5 1px, transparent 1px)', backgroundSize: '20px 20px' }}>
              </div>

              <header className="sticky top-0 z-50 bg-[#fff7ed]/90 backdrop-blur-md border-b border-rose-200 p-4 shadow-sm">
                <div className="max-w-md mx-auto flex justify-between items-center">
                  <div className="flex items-center gap-2">
                    <div className="bg-white p-1.5 rounded-full shadow-sm border border-rose-100">
                      <span className="text-xl">ğŸ“</span>
                    </div>
                    <div>
                      <h1 className="text-lg font-black text-rose-500 tracking-tight">
                        å¿ƒç‰©èªå¹¸é‹æŠ½æŠ½æ¨‚
                      </h1>
                      <p className="text-[10px] font-bold text-amber-600 tracking-widest">KOKOROLIA KUJI</p>
                    </div>
                  </div>
                  <div className="flex items-center gap-2 bg-white px-3 py-1.5 rounded-full border-2 border-amber-100 shadow-sm">
                    <div className={coinAnimating ? 'animate-coin-jump' : ''}>
                      <Coins size={16} className="text-amber-400 fill-amber-400" />
                    </div>
                    <span className={`font-mono font-bold text-stone-600 transition-colors ${coinAnimating ? 'text-amber-500' : ''}`}>{coins}</span>
                    <button 
                        onClick={() => setShowRPS(true)}
                        className="ml-2 w-5 h-5 flex items-center justify-center rounded-full bg-rose-400 text-white text-[10px] hover:bg-rose-500 transition-colors shadow-sm"
                    >
                        +
                    </button>
                  </div>
                </div>
              </header>

              <main className="max-w-md mx-auto p-4 space-y-6 relative z-10">

                {activeTab === 'gacha' && (
                  <div className="space-y-6 animate-fade-in">
                    <div className="relative overflow-hidden rounded-3xl bg-white border-4 border-[#fed7aa] p-6 text-center shadow-xl shadow-orange-100">
                      {/* Decorative Background Elements */}
                      <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-rose-300 via-amber-300 to-rose-300"></div>
                      <div className="absolute -top-10 -right-10 w-32 h-32 bg-rose-100 rounded-full blur-2xl opacity-50"></div>
                      <div className="absolute -bottom-10 -left-10 w-32 h-32 bg-amber-100 rounded-full blur-2xl opacity-50"></div>
                      
                      <Sparkles className="mx-auto text-amber-400 mb-2 animate-spin-slow" size={40} />
                      <h2 className="text-2xl font-black text-stone-700 mb-1 drop-shadow-sm">å¿ƒç‰©èªå¹¸é‹æŠ½æŠ½æ¨‚</h2>
                      <p className="text-sm text-stone-500 font-medium mb-1">æŠ•å…¥å¿ƒä¹‹å¹£ï¼Œç¥ˆæ±‚å‚³èªªä¸­çš„å¹»ä¹‹é€¸å“</p>
                      <p className="text-[10px] text-stone-400 mb-1">(æ‰€æœ‰çé …å…§å®¹å¯åœ¨å€‰åº«ä¸­çš„å…¨åœ–é‘‘è£¡æŸ¥çœ‹)</p>
                      <p className="text-xs text-rose-400 font-bold mb-6">ä¸å–œæ­¡çš„çå“ä¹Ÿå¯ä»¥ç”¨åˆæˆè¡“è©¦è©¦æ‰‹æ°£</p>
                      
                      {/* ç´¯è¨ˆæŠ½æ•¸èˆ‡ä¿åº•æç¤º */}
                      <div className="mb-4 bg-[#fff7ed] p-2 rounded-lg border border-amber-100 flex justify-between items-center text-xs">
                         <span className="font-bold text-stone-600">ç´¯è¨ˆæŠ½æ•¸: {totalDraws}</span>
                         <span className="font-bold text-rose-500">è·é›¢ä¿åº•UR: {100 - pityCounter} æŠ½</span>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <button 
                          onClick={() => handleDraw(1)}
                          className="group relative overflow-hidden rounded-2xl bg-[#fff7ed] p-3 hover:bg-rose-50 transition-all shadow-md active:scale-95 border border-rose-100"
                        >
                          <div className="text-xs text-stone-400 mb-1 font-bold">å–®æŠ½</div>
                          <div className="text-xl font-black text-rose-500">100 å¹£</div>
                        </button>
                        <button 
                          onClick={() => handleDraw(10)}
                          className="group relative overflow-hidden rounded-2xl bg-gradient-to-b from-amber-200 to-amber-300 p-3 transition-all shadow-lg active:scale-95 border-2 border-white"
                        >
                          <div className="text-xs text-amber-800/80 mb-1 font-bold">åé€£æŠ½</div>
                          <div className="text-xl font-black text-amber-900">1000 å¹£</div>
                          <div className="absolute -right-3 -top-3 bg-rose-500 text-white text-[9px] font-bold px-3 py-1 rotate-12 shadow-sm">
                            HOT
                          </div>
                          <Sparkles className="absolute bottom-1 right-1 text-white/50" size={16} />
                        </button>
                      </div>
                    </div>

                    {lastDraw && (
                      <div className="space-y-3 bg-white p-4 rounded-3xl shadow-sm border border-rose-100">
                        <div className="flex justify-between items-center px-1">
                          <h3 className="text-lg font-bold text-stone-700 flex items-center gap-2">
                            <Gift className="text-rose-400" size={20} />
                            åˆæˆçµæœ
                          </h3>
                          <button onClick={() => setLastDraw(null)} className="text-xs text-rose-400 font-bold hover:text-rose-600">æ¸…é™¤</button>
                        </div>
                        <div className="grid grid-cols-2 gap-3">
                          {lastDraw.map((item) => (
                            <ItemCard key={item.id} item={item} />
                          ))}
                        </div>
                      </div>
                    )}
                    
                    <div className="rounded-2xl bg-white p-5 border border-rose-100 shadow-sm">
                      <h4 className="font-bold mb-3 text-stone-400 text-xs uppercase tracking-wider text-center">æ©Ÿç‡å…¬ç¤º</h4>
                      <div className="space-y-2 text-xs">
                        {TIER_ORDER.map((key) => {
                          const val = TIERS[key];
                          return (
                            <div key={key} className="flex justify-between items-center p-2 rounded-lg bg-[#fff7ed]">
                              <span className={`font-bold flex items-center gap-1 ${val.color}`}>
                                {val.icon} {val.label} {val.name}
                              </span>
                              <span className="font-mono font-bold text-stone-400">{(val.probability * 100).toFixed(0)}%</span>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  </div>
                )}

                {activeTab === 'alchemy' && (
                  <div className="space-y-6 animate-fade-in">
                     <div className="rounded-3xl bg-white border-4 border-rose-100 p-6 text-center relative overflow-hidden shadow-xl shadow-rose-100/50">
                        <div className="absolute -top-10 -left-10 w-24 h-24 bg-rose-100 rounded-full blur-2xl opacity-50"></div>
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5"></div>
                        
                        <div className="relative z-10">
                          <div className="w-16 h-16 bg-[#fff7ed] rounded-full flex items-center justify-center mx-auto mb-3 shadow-inner border border-rose-100">
                            <FlaskConical className="text-rose-500 ml-1" size={32} />
                          </div>
                          <h2 className="text-xl font-black text-rose-500">é­”æ³•åˆæˆå°</h2>
                          <p className="text-xs text-rose-400 mb-6 font-medium bg-rose-50 inline-block px-3 py-1 rounded-full">
                            æŠ•å…¥ 4 å€‹ç´ æ ğŸ”¥ / 33% å¤±æ•—ç‡ ğŸ’¥
                          </p>

                          <div className="grid grid-cols-4 gap-2 mb-8">
                            {[0, 1, 2, 3].map((index) => (
                               <div key={index} className={`aspect-[3/4] rounded-xl border-2 border-dashed flex flex-col items-center justify-center transition-all duration-300 ${selectedIds[index] ? 'border-rose-300 bg-rose-50 shadow-md' : 'border-stone-200 bg-stone-50'}`}>
                                 {selectedIds[index] ? (
                                   <div className="text-2xl animate-bounce-small">ğŸ</div>
                                 ) : (
                                   <span className="text-stone-300 text-[10px] font-bold text-center leading-none">
                                     Slot<br/>{index + 1}
                                   </span>
                                 )}
                               </div>
                            ))}
                          </div>

                          <button
                            disabled={selectedIds.length !== 4}
                            onClick={handleTransmute}
                            className={`
                              w-full py-4 rounded-2xl font-black text-lg shadow-lg flex items-center justify-center gap-2 transition-all active:scale-95
                              ${selectedIds.length === 4 
                                ? 'bg-gradient-to-r from-rose-400 to-rose-500 text-white shadow-rose-200' 
                                : 'bg-stone-200 text-stone-400 cursor-not-allowed'}
                            `}
                          >
                            <Zap size={20} className={selectedIds.length === 4 ? 'fill-yellow-300 text-yellow-300' : ''} />
                            é–‹å§‹åˆæˆ
                          </button>
                        </div>
                     </div>

                     {alchemyResult && (
                       <div className={`p-6 rounded-3xl border-4 text-center animate-bounce-in shadow-xl ${alchemyResult.status === 'success' ? 'bg-amber-50 border-amber-200' : 'bg-stone-100 border-stone-200'}`}>
                         <div className="text-4xl mb-2">{alchemyResult.status === 'success' ? 'ğŸ‰' : 'ğŸ’¥'}</div>
                         <h3 className={`font-black text-xl mb-1 ${alchemyResult.status === 'success' ? 'text-amber-600' : 'text-stone-500'}`}>
                           {alchemyResult.status === 'success' ? 'åˆæˆå¤§æˆåŠŸï¼' : 'åˆæˆå¤±æ•—...'}
                         </h3>
                         <p className="text-sm text-stone-500 mb-4 font-bold">
                           {alchemyResult.status === 'success' ? 'å¤ªç¥å•¦ï¼å¿…å®šç²å¾— SR ç‰©å“ï¼' : 'å—šå—š...ç‰©å“åŠ£åŒ–æˆæ™®é€šé›œç‰©äº†'}
                         </p>
                         <div className="max-w-[160px] mx-auto transform rotate-2 hover:rotate-0 transition-transform">
                           <ItemCard item={alchemyResult.item} />
                         </div>
                         <button onClick={() => setAlchemyResult(null)} className="mt-6 text-sm font-bold text-stone-400 hover:text-stone-600 px-4 py-2 bg-white rounded-full border border-stone-200">å†ä¾†ä¸€æ¬¡</button>
                       </div>
                     )}

                     <div className="space-y-3">
                       <h3 className="text-sm font-bold text-stone-500 px-2 flex items-center gap-2">
                         <ShoppingBag size={14} /> é¸æ“‡åº«å­˜ç´ æ (éœ€4å€‹åŒéšç´š)ï¼š
                       </h3>
                       <div className="grid grid-cols-2 gap-3 max-h-[400px] overflow-y-auto pr-1 pb-20">
                         {sortedInventory.length === 0 && (
                           <div className="col-span-2 text-center py-10 bg-white rounded-2xl border border-dashed border-stone-300">
                             <p className="text-stone-400 font-bold">åº«å­˜ç©ºç©ºå¦‚ä¹Ÿï¼Œå»æŠ½çå§ï¼</p>
                           </div>
                         )}
                         {sortedInventory.map(item => (
                           <div key={item.id} className={`transition-opacity duration-200 ${selectedIds.includes(item.id) ? 'opacity-100 scale-95' : 'opacity-100'}`}>
                             <ItemCard 
                                item={item} 
                                isSelected={selectedIds.includes(item.id)} 
                                onClick={toggleSelection}
                              />
                           </div>
                         ))}
                       </div>
                     </div>
                  </div>
                )}

                {activeTab === 'inventory' && (
                  <div className="space-y-4 animate-fade-in">
                    <div className="bg-white p-2 rounded-2xl shadow-sm border border-rose-100">
                      <div className="flex justify-between items-center px-2 mb-3">
                        <h2 className="text-lg font-black text-stone-700 flex items-center gap-2">
                          <Ticket className="text-rose-400" /> æˆ‘çš„æ”¶è—
                        </h2>
                        <div className="flex bg-[#fff7ed] p-1 rounded-full">
                          <button 
                            onClick={() => setInventoryView('owned')}
                            className={`px-3 py-1 rounded-full text-xs font-bold transition-all ${inventoryView === 'owned' ? 'bg-white shadow-sm text-rose-500' : 'text-stone-400 hover:text-stone-600'}`}
                          >
                             æŒæœ‰ç‰©å“
                          </button>
                          <button 
                            onClick={() => setInventoryView('collection')}
                            className={`px-3 py-1 rounded-full text-xs font-bold transition-all flex items-center gap-1 ${inventoryView === 'collection' ? 'bg-white shadow-sm text-rose-500' : 'text-stone-400 hover:text-stone-600'}`}
                          >
                             <BookOpen size={12}/> å…¨åœ–é‘‘
                          </button>
                        </div>
                      </div>

                      {inventoryView === 'owned' && (
                        <div className="grid grid-cols-5 gap-2 text-center text-[10px] animate-fade-in">
                           {TIER_ORDER.map(tier => {
                             const count = inventory.filter(i => i.tier === tier).length;
                             const style = TIERS[tier];
                             return (
                               <div key={tier} className={`flex flex-col items-center justify-center p-2 rounded-xl bg-[#fff7ed] border ${style.border}`}>
                                 <div className="text-base mb-1">{style.icon}</div>
                                 <div className={`font-black ${style.color}`}>{tier}</div>
                                 <div className="text-stone-400 font-mono mt-1">{count}</div>
                               </div>
                             )
                           })}
                        </div>
                      )}
                    </div>

                    <div className="space-y-4 pb-20 animate-fade-in">
                        {TIER_ORDER.map(tier => {
                          const tierItems = inventoryView === 'owned' 
                            ? inventory.filter(i => i.tier === tier)
                            : ITEMS_DATA[tier];
                          
                          // In collection mode always show. In owned mode show if items exist.
                          if (inventoryView === 'owned' && tierItems.length === 0) return null;

                          return (
                            <div key={tier} className="bg-white rounded-2xl border border-rose-100 overflow-hidden shadow-sm">
                              <button 
                                onClick={() => toggleTier(tier)}
                                className={`w-full flex items-center justify-between p-3 ${TIERS[tier].bg} transition-colors`}
                              >
                                <div className="flex items-center gap-2">
                                  <span className={`text-xl`}>{TIERS[tier].icon}</span>
                                  <span className={`font-black ${TIERS[tier].color}`}>{TIERS[tier].label}</span>
                                  <span className="text-xs text-stone-500 font-bold">{TIERS[tier].name}</span>
                                </div>
                                <div className="flex items-center gap-2">
                                  <span className="text-xs font-bold text-stone-400 bg-white/50 px-2 py-0.5 rounded-full">
                                    {inventoryView === 'owned' ? `${tierItems.length} ä»¶` : 'å…¨åœ–é‘‘'}
                                  </span>
                                  {expandedTiers[tier] ? <ChevronUp size={16} className="text-stone-400"/> : <ChevronDown size={16} className="text-stone-400"/>}
                                </div>
                              </button>
                              
                              {expandedTiers[tier] && (
                                <div className="p-3 bg-[#fff7ed]/30">
                                  <div className="grid grid-cols-2 gap-3">
                                     {inventoryView === 'owned' 
                                       ? tierItems.map((item) => (
                                           <ItemCard key={item.id} item={item} />
                                         ))
                                       : tierItems.map(itemName => {
                                            const count = inventory.filter(i => i.name === itemName).length;
                                            const isOwned = count > 0;
                                            const mockItem = { id: itemName, tier: tier, name: itemName };
                                            return (
                                              <ItemCard 
                                                key={itemName} 
                                                item={mockItem} 
                                                isCollectionMode={true} 
                                                isOwned={isOwned} 
                                                count={count}
                                              />
                                            );
                                         })
                                     }
                                  </div>
                                </div>
                              )}
                            </div>
                          );
                        })}
                        
                        {inventoryView === 'owned' && inventory.length === 0 && (
                          <div className="text-center py-20 text-stone-400">
                            <div className="w-16 h-16 bg-[#fff7ed] rounded-full flex items-center justify-center mx-auto mb-4">
                              <ShoppingBag size={24} className="opacity-50" />
                            </div>
                            <p className="font-bold">é€™è£¡ä»€éº¼éƒ½æ²’æœ‰...</p>
                            <p className="text-xs mt-1">å»æŠ½é»å¥½æ±è¥¿å§ï¼</p>
                          </div>
                        )}
                    </div>

                  </div>
                )}

              </main>

              <nav className="fixed bottom-0 w-full bg-[#fff7ed]/90 backdrop-blur-lg border-t border-rose-100 pb-safe z-50 rounded-t-3xl shadow-[0_-5px_20px_-5px_rgba(0,0,0,0.05)]">
                <div className="max-w-md mx-auto flex justify-around p-3">
                  <button 
                    onClick={() => setActiveTab('gacha')}
                    className={`flex flex-col items-center p-2 transition-all active:scale-95 ${activeTab === 'gacha' ? 'text-rose-500 -translate-y-2' : 'text-stone-400 hover:text-rose-400'}`}
                  >
                    <div className={`p-2 rounded-full ${activeTab === 'gacha' ? 'bg-rose-100 shadow-lg shadow-rose-200' : ''}`}>
                      <Sparkles size={24} className={activeTab === 'gacha' ? 'fill-rose-500' : ''} />
                    </div>
                    <span className="text-[10px] font-bold mt-1">è½‰è›‹</span>
                  </button>
                  
                  <button 
                    onClick={() => setActiveTab('alchemy')}
                    className={`flex flex-col items-center p-2 transition-all active:scale-95 ${activeTab === 'alchemy' ? 'text-amber-600 -translate-y-2' : 'text-stone-400 hover:text-amber-500'}`}
                  >
                    <div className={`relative p-2 rounded-full ${activeTab === 'alchemy' ? 'bg-amber-100 shadow-lg shadow-amber-200' : ''}`}>
                      <FlaskConical size={24} className={activeTab === 'alchemy' ? 'fill-amber-600' : ''} />
                      {activeTab !== 'alchemy' && inventory.length >= 4 && (
                        <span className="absolute top-0 right-0 w-3 h-3 bg-rose-500 border-2 border-white rounded-full animate-ping"></span>
                      )}
                    </div>
                    <span className="text-[10px] font-bold mt-1">åˆæˆè¡“</span>
                  </button>

                  <button 
                    onClick={() => setActiveTab('inventory')}
                    className={`flex flex-col items-center p-2 transition-all active:scale-95 ${activeTab === 'inventory' ? 'text-blue-500 -translate-y-2' : 'text-stone-400 hover:text-blue-400'}`}
                  >
                    <div className={`p-2 rounded-full ${activeTab === 'inventory' ? 'bg-blue-100 shadow-lg shadow-blue-200' : ''}`}>
                      <ShoppingBag size={24} className={activeTab === 'inventory' ? 'fill-blue-500' : ''} />
                    </div>
                    <span className="text-[10px] font-bold mt-1">å€‰åº«</span>
                  </button>
                </div>
              </nav>

            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>